---
layout: post
title: "[TIL] 2025-04-01 / JPA"
date: 2025-04-01 20:20:00 +0900
categories: 
  - til
  - main-camp
---

* toc
{:toc}

## ğŸ“– Today I Learned
### JPA

<!-- <h4> ğŸ“ƒ </h4> -->

---

#### - JPA
- ìë°” ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ì™€ ê°ì²´ë¥¼ ë§¤í•‘í•˜ì—¬ ë‹¤ë£° ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ìë°” í‘œì¤€ API
- SQLì„ ì§ì ‘ ì‘ì„±í•˜ì§€ ì•Šê³ ë„ Java ê°ì²´ë¥¼ ì´ìš©í•´ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê´€ë¦¬ í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” ê¸°ìˆ 

#### - ì£¼ìš” ê°œë…
- Entity
  - ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ê³¼ ë§¤í•‘ë˜ëŠ” í´ë˜ìŠ¤
  - `@Entity` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ì„ ì–¸
  - `@Entity` -> `user` í´ë˜ìŠ¤ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”ê³¼ ë§¤í•‘
  - `@Id` -> ê¸°ë³¸í‚¤
  - `@GeneratedValue(strategy = GenerationType.IDENTITY)` ìë™ì¦ê°€

```java
@Entity
public class User {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY) 
    private Long id;

    private String name;
    private String email;
}
```

- EntityManager
  - ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥í•˜ê±°ë‚˜ ì¡°íšŒ, ìˆ˜ì •, ì‚­ì œí•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì¸í„°í˜ì´ìŠ¤
  - JPAì—ì„œëŠ” SQL ëŒ€ì‹  `EntityManager`ë¥¼ ì´ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì¡°ì‘
  - `EntityManagerFactory` : ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬
  - `EntityManager` : ì—”í‹°í‹°ë¥¼ ê´€ë¦¬í•˜ëŠ” í•µì‹¬ ê°ì²´
  - `persist()` : ì—”í‹°í‹°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥
  - `getTransaction().begin()` : íŠ¸ëœì­ì…˜ ì‹œì‘
  - `commit()` : ë³€ê²½ì‚¬í•­ ì €ì¥

```java
EntityManagerFactory emf = Persistence.createEntityManagerFactory("my-persistence-unit");
EntityManager em = emf.createEntityManager();
em.getTransaction().begin(); // íŠ¸ëœì­ì…˜ ì‹œì‘

User user = new User();
user.setName("John Doe");
user.setEmail("john@example.com");

em.persist(user); // ë°ì´í„° ì €ì¥
em.getTransaction().commit(); // íŠ¸ëœì­ì…˜ ì»¤ë°‹

em.close();
emf.close();
```

- JPQL (Java Persistence Query Language)
  - JAPëŠ” SQL ëŒ€ì‹  **ê°ì²´ ì¤‘ì‹¬ì˜ ì¿¼ë¦¬ ì–¸ì–´**ë¥¼ ì‚¬ìš©
  - SQLê³¼ ë¹„ìŠ·í•˜ì§€ë§Œ í…Œì´ë¸”ì´ ì•„ë‹Œ ì—”í‹°í‹° ê°ì²´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¿¼ë¦¬ë¥¼ ì‘ì„±

```java
String jpql = "SELECT u FROM User u WHERE u.name = :name";
TypedQuery<User> query = em.createQuery(jpql, User.class);
query.setParameter("name", "John Doe");

List<User> users = query.getResultList();
```

#### - JPA ì¥ì 
- ê°ì²´ ì§€í–¥ì ì¸ ë°ì´í„° ì²˜ë¦¬
  - SQLì„ ì§ì ‘ ì‚¬ìš©í•˜ì§€ ì•Šê³  JAVA ì½”ë“œë§Œìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì¡°ì‘ ê°€ëŠ¥
- ë°ì´í„°ë² ì´ìŠ¤ ì¢…ì†ì„± ê°ì†Œ
  - íŠ¹ì • DBMSì— ì˜ì¡´í•˜ì§€ ì•Šê³  ì„¤ì •ë§Œ ë³€ê²½í•˜ë©´ ë‹¤ë¥¸ DBë¡œ ì‰½ê²Œ ë³€ê²½ ê°€ëŠ¥
- ìƒì‚°ì„± í–¥ìƒ
  - ë°˜ë³µì ì¸ SQL ì‘ì„±ì´ ì¤„ì–´ë“¤ê³  ìœ ì§€ë³´ìˆ˜ì„±ì´ ì¢‹ì•„ì§
- íŠ¸ëœì­ì…˜ ê´€ë¦¬ ì§€ì›
  - `@Transactional`ê°™ì€ ì–´ë…¸í…Œì´ì…˜ì„ í™œìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ íŠ¸ëœì­ì…˜ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŒ

#### - JPA ë™ì‘ ë°©ì‹
1. ì—”í‹°í‹° ê°ì²´ ìƒì„±
2. EntityManagerë¥¼ ì´ìš©í•´ ë°ì´í„° ì €ì¥
3. í•„ìš”í• ë•Œ JPQLë¡œ ë°ì´í„° ì¡°íšŒ
4. ë°ì´í„° ë³€ê²½ ì‹œ merge() ì‚­ì œí• ë•Œ remove() ì‚¬ìš©
5. íŠ¸ëœì­ì…˜ì„ commit()í•˜ì—¬ DBì— ë°˜ì˜

<!-- --- -->

<!-- <h2> ğŸ’¬ </h2> -->

<!-- <h4>  </h4> -->
