---
layout: post
title: "[TIL] 2025-04-02 / 영속성 컨텍스트"
date: 2025-04-02 20:20:00 +0900
categories: 
  - til
  - main-camp
---

* toc
{:toc}

## 📖 Today I Learned
### 영속성 컨텍스트

<!-- <h4> 📃 </h4> -->

---

#### - 영속성 컨텍스트
- JPA에서 엔티티를 관리하는 1차 캐시 역할을 하는 개념
- JPA에서 엔티티 객체를 저장하고 관리하는 가상의 데이터 저장소

#### - 역할
- 엔티티 객채를 관리하며 트랜잭션 범위 내에서 엔티티의 상태를 유지
1. 엔티티의 생명주기 관리
   - 비영속 : JPA와 관련 없는 일반 객체
   - 영속 : 영속성 컨텍스트에 저장된 객체
   - 준영속 : 영속성 컨텍스트에서 분리된 객체
   - 삭제 : 삭제 예정 상태
2. 1차 캐시
   - 영속성 컨텍스트는 엔티티를 메모리에 저장
   - 같은 트랜잭션 내에서 동일한 엔티티를 조회하면 DB를 다시 조회하지 않고 1차 캐시에서 가져옴
   - 효율적인 조회 성능을 제공하며 불필요한 DB 접근을 줄임
3. 변경 감지
   - 영속 상태의 엔티티는 JPA가 자동으로 변경 사항을 감지하여 업데이트
   - `em.persist()`를 다시 호출하지 않아도 트랜잭션을 커밋하면 변경된 값이 자동 반영됨
4. 쓰기 지연
   - `em.persist(entity)`를 호출해도 즉시 실행하지 않고 트랜잭션을 커밋 할 때 한꺼번에 실행
   - 여러개의 `persist()`를 실행해도 DB 부하를 줄일 수 있음
5. 자동 플러시
   - `flush()`는 영속성 컨텍스트의 변경사항을 DB에 반영하는 과정
   - 트랜잭션이 커밋되면 `flush()`가 자동 실행되어 변경 사항이 반영

#### - 영속성 컨텍스트를 사용하지 않을 경우 문제점
- 매번 DB에서 조회하여 성능 저하
- 객체 변경 시 수동으로 `update` 실행 필요
- 쓰기 지연이 없어 다수의 SQL 실행 시 성능 저하


<!-- --- -->

<!-- <h2> 💬 </h2> -->

<!-- <h4>  </h4> -->
