---
layout: post
title: "[TIL] 2025-04-21 / CRUD ê°œì„  ë° í…ŒìŠ¤íŠ¸ ì½”ë“œ ê³¼ì œ Lv 5 ì •ë¦¬"
date: 2025-04-21 11:00:00 +0900
categories: 
  - til
  - main-camp
---

* toc
{:toc}

## ğŸ“– Today I Learned
### CRUD ê°œì„  ë° í…ŒìŠ¤íŠ¸ ì½”ë“œ ê³¼ì œ Lv 5 ì •ë¦¬

<!-- <h4> ğŸ“ƒ </h4> -->

---

#### - JwtFilter

```java
if (url.startsWith("/admin")) {
                // ê´€ë¦¬ì ê¶Œí•œì´ ì—†ëŠ” ê²½ìš° 403ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
    if (!UserRole.ADMIN.equals(userRole)) {
        httpResponse.sendError(HttpServletResponse.SC_FORBIDDEN, "ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        return;
    }
    chain.doFilter(request, response);
    return;
}
```

- if ë¬¸ì´ 2ë²ˆì´ë‚˜ ë“¤ì–´ê°ˆ í•„ìš”ê°€ ì—†ì–´ë³´ì„
- if ë¬¸ì„ í•˜ë‚˜ë¡œ í•©ì¹˜ë©´ chain.doFilter ë˜í•œ ì—†ì–´ì ¸ë„ ë ê±° ê°™ìŒ

```java
if (url.startsWith("/admin") && !UserRole.ADMIN.equals(userRole)) {
    httpResponse.sendError(HttpServletResponse.SC_FORBIDDEN, "ê´€ë¦¬ì ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");

    return;
}
```

#### - SignupRequest

```java
@NotBlank @Email
private String email;
```

- @Email ì–´ë…¸í…Œì´ì…˜ì€ ì´ë©”ì¼ í˜•ì‹ì— test@test ì²˜ëŸ¼ ë’¤ì— . ì´ ì—†ì–´ë„ í†µê³¼ ê°€ëŠ¥

```java
@NotBlank
@Pattern(regexp="^[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])*@[0-9a-zA-Z]([-_.]?[0-9a-zA-Z])+[.][a-zA-Z]{2,3}$", message = "ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.")
private String email;
```

- ì •ê·œ í‘œí˜„ì‹ìœ¼ë¡œ ë°”ê¾¸ë©´ ë¶ˆê°€ëŠ¥

#### - SignupRequest

```java
@NotBlank
private String password;
```

- ë¹„ë°€ë²ˆí˜¸ ìµœì†Œ ì¡°ê±´ ì¶”ê°€

```java
@NotBlank
@Pattern(regexp = "^[a-zA-Z0-9!@#$%^&*]{8,16}$", message = "ë¹„ë°€ë²ˆí˜¸ëŠ” 8 ~ 16ìì˜ ì˜ë¬¸ ëŒ€ì†Œë¬¸ì, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¡œ ì´ë£¨ì–´ì ¸ì•¼ í•©ë‹ˆë‹¤.")
private String password;
```

#### - commentRepository

```java
@Query("SELECT c FROM Comment c JOIN FETCH c.user WHERE c.todo.id = :todoId")
List<Comment> findByTodoIdWithUser(@Param("todoId") Long todoId);
```

- @Queryë³´ë‹¤ @EntityGraph ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ í–¥ìƒì— ìˆì–´ ìœ ë¦¬í•˜ë‹¤ê³  ìƒê°

```java
@EntityGraph(attributePaths = {"user", "todo"})
List<Comment> findByTodoId(Long todoId);
```

#### - managerRepository

```java
@Query("SELECT m FROM Manager m JOIN FETCH m.user WHERE m.todo.id = :todoId")
List<Manager> findByTodoIdWithUser(@Param("todoId") Long todoId);
```

- @Queryë³´ë‹¤ @EntityGraph ê°€ë…ì„± ë° ìœ ì§€ë³´ìˆ˜ í–¥ìƒì— ìˆì–´ ìœ ë¦¬í•˜ë‹¤ê³  ìƒê°

```java
@EntityGraph(attributePaths = {"user", "todo"})
List<Manager> findByTodoId(Long todoId);
```

#### - ManagerService

```java
ObjectUtils.nullSafeEquals()
```

- ìì£¼ ì‚¬ìš©ë˜ëŠ”ê±° ê°™ì•„ ë©”ì„œë“œí™”

```java
public boolean nullSafeEqual(Long firstId, Long secondId) {
    return ObjectUtils.nullSafeEquals(firstId, secondId);
}
```

#### - UserService

```java
passwordEncoder.matches()
```

- ìì£¼ ì‚¬ìš©ë˜ëŠ”ê±° ê°™ì•„ ë©”ì„œë“œí™”

```java
public boolean isMatchesPassword(String firstPassword, String secondPassword) {
    return passwordEncoder.matches(firstPassword, secondPassword);
}
```

#### - UserAdminController

```java
@PutMapping("/users")
public void changePassword(@Auth AuthUser authUser, @RequestBody UserChangePasswordRequest userChangePasswordRequest) {
    userService.changePassword(authUser.getId(), userChangePasswordRequest);
}
```

- dtoì˜ bean validationì„ ì‚¬ìš©í•˜ì—¬ ê²€ì¦í•˜ê¸° ìœ„í•´ @Valid ì¶”ê°€

```java
@PutMapping("/users")
public void changePassword(@Auth AuthUser authUser, @Valid @RequestBody UserChangePasswordRequest userChangePasswordRequest) {
    userService.changePassword(authUser.getId(), userChangePasswordRequest);
}
```

#### - UserController

```java
@PatchMapping("/admin/users/{userId}")
public void changeUserRole(@PathVariable("userId") long userId, @RequestBody UserRoleChangeRequest userRoleChangeRequest) {
    userAdminService.changeUserRole(userId, userRoleChangeRequest);
}
```

- dtoì˜ bean validationì„ ì‚¬ìš©í•˜ì—¬ ê²€ì¦í•˜ê¸° ìœ„í•´ @Valid ì¶”ê°€

```java
@PatchMapping("/admin/users/{userId}")
public void changeUserRole(@PathVariable("userId") long userId, @Valid @RequestBody UserRoleChangeRequest userRoleChangeRequest) {
    userAdminService.changeUserRole(userId, userRoleChangeRequest);
}
```

#### - UserRoleChangeRequest

- ì—­í• ì„ ê³µë°±ìœ¼ë¡œ ë³´ë‚´ëŠ” ê²ƒì„ ë§‰ê¸° ìœ„í•´ @NotNull ì¶”ê°€

```java
@NotNull
private String role;
```

<!-- --- -->

<!-- <h2> ğŸ’¬ </h2> -->

<!-- <h4>  </h4> -->
